# Handover Document - January 12, 2026

## Status: ✅ Most Features Working

### What's Working

1. **Module 21 (Route 1 - Single Property)**
   - All field mappings working correctly
   - Bath values mapping (`2.5` → `2point5`) working
   - Market performance values preserving 2 decimal places
   - Price group calculation and display working
   - Body corp fields triggering correctly for "Owners Corp (Community)"
   - Property address and project address are separate fields (not overwriting)

2. **Module 22 (Route 2 - Projects with Multiple Lots)**
   - All field mappings working correctly
   - Property address built from address components (not project address)
   - Project address stored separately in GHL
   - Bath values mapping working
   - Market performance values preserving 2 decimal places
   - Lot-level cashback/rebate type defaulting to "Cashback"

3. **Form Features**
   - Scroll behavior when "Continue with Packaging" clicked
   - Cashback/Rebate Type defaulting:
     - Project-level: Defaults to "Cashback"
     - Lot-level: Defaults to "Cashback" for all lots
   - Folder name: Always uses `propertyAddress` from Step 1 (not `projectAddress`)
   - Price group: Displays friendly values in UI, sends GHL Option Keys to Make.com
   - Investment Highlights integration working

4. **Deployed to Vercel**
   - Scroll behavior fix
   - Cashback/Rebate Type lot-level defaults fix
   - Folder name fix (uses propertyAddress)

## Pending Issues / Todo List

### 1. Property Address Display at Top of Pages ⚠️
**Issue:** Property address should be displayed at the top of each page (e.g., "Property Address: 17 Barker St Lewisham NSW 2049") but currently not showing.

**Location:** `src/components/MultiStepForm.tsx` lines 906-911

**Code:** The display logic exists and looks correct:
```typescript
{formData?.address?.propertyAddress && (
  <div className="mb-6 pb-4 border-b">
    <div className="flex items-center gap-4">
      <div className="flex items-center gap-2 flex-1">
        <span className="text-sm font-semibold text-gray-700">Property Address:</span>
        <span className="text-sm text-gray-900 font-medium">{formData.address.propertyAddress}</span>
      </div>
```

**Problem:** `formData.address.propertyAddress` appears to be empty or not set, so the conditional doesn't render.

**Investigation Needed:**
- Check if `propertyAddress` is being cleared somewhere
- Verify it's being set correctly in Step 0
- Check if there's a persistence issue with the form store

### 2. Other Todo Items
- Review any other items in the codebase todo list
- Verify all field mappings are correct after recent changes

## Recent Changes Made

### Module 21 & 22 (Make.com)
1. **Bath Value Mapping:** Added `mapBathValue()` function to convert `"2.5"` → `"2point5"` for GHL
2. **Market Performance Decimals:** Added `toFloat2Decimals()` to preserve 2 decimal places
3. **Property Address Fix (Module 22):** Changed to build from address components instead of project address

### Form Code
1. **Scroll Behavior:** Added smooth scroll when "Continue with Packaging" clicked
2. **Cashback/Rebate Type Defaults:**
   - Fixed lot-level dropdown options to use lowercase values (`'cashback'` not `'Cashback'`)
   - Ensured defaults apply even if only one field is missing
3. **Folder Name:** Changed to always use `propertyAddress` (removed `projectAddress` logic)

## Important Notes

### Field Separation
- **`property_address`** and **`project_address`** are SEPARATE fields in GHL
- They do NOT overwrite each other
- `property_address` = actual property address (used for folder names, individual lots)
- `project_address` = separate field for project address (stored in GHL but NOT used for folder names)

### Folder Name Logic
- **ALWAYS uses `propertyAddress` from Step 1**
- Do NOT use `projectAddress` for folder names
- See `FOLDER-NAME-LOGIC-NOTE.md` for details

### Cashback/Rebate Type
- TypeScript type: `'cashback' | 'rebate'` (lowercase)
- Dropdown values: `'cashback'`, `'rebate'` (removed 'rebate_on_land', 'rebate_on_build', 'other' - updated 2025-01-14)
- Defaults to `'cashback'` for both project-level and lot-level
- GHL field: `cashback_rebate_type` (recreated 2025-01-14 with simplified options)

## Files Modified (Recent Session)

### Make.com Modules
- `MODULE-21-FIXED-CODE.js` - Bath mapping, market performance decimals
- `ROUTE-2-MODULE-22-COMPLETE-CODE.js` - Property address fix, bath mapping, market performance decimals

### Form Code
- `src/components/steps/Step0AddressAndRisk.tsx` - Scroll behavior
- `src/components/steps/Step2PropertyDetails.tsx` - Cashback/Rebate Type defaults
- `src/components/steps/Step6FolderCreation.tsx` - Folder name logic

## Next Steps

1. **Fix Property Address Display**
   - Investigate why `propertyAddress` is not showing at top of pages
   - Check form store persistence
   - Verify Step 0 is setting `propertyAddress` correctly

2. **Testing**
   - Test both Route 1 and Route 2 end-to-end
   - Verify all fields populate correctly in GHL
   - Confirm folder names use correct address

3. **Documentation**
   - Update any relevant docs with folder name logic
   - Document the property/project address separation

## Code Locations

- **Property Address Display:** `src/components/MultiStepForm.tsx:906-911`
- **Folder Name Logic:** `src/components/steps/Step6FolderCreation.tsx:33-35`
- **Cashback Defaults:** `src/components/steps/Step2PropertyDetails.tsx:110-124` (project-level), `3461-3474` (lot-level)
- **Module 21:** `MODULE-21-FIXED-CODE.js`
- **Module 22:** `ROUTE-2-MODULE-22-COMPLETE-CODE.js`
